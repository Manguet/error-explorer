{% extends 'dashboard/base.html.twig' %}

{% block title %}Changer le mot de passe - {{ parent() }}{% endblock %}

{% block page_header %}
    <div class="page-header">
        <div class="page-header__content">
            <nav class="breadcrumb">
                <a href="{{ path('dashboard_profile_index') }}" class="breadcrumb__link">Mon Profil</a>
                <span class="breadcrumb__separator">/</span>
                <span class="breadcrumb__current">Changer le mot de passe</span>
            </nav>
            <h1 class="page-header__title">Changer le mot de passe</h1>
            <p class="page-header__subtitle">Renforcez la sécurité de votre compte</p>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="profile-password">
        <div class="profile-password__container">
            {{ form_start(form, {'attr': {'class': 'form form--password'}}) }}
                <div class="form__section">
                    <h2 class="form__section-title">Nouveau mot de passe</h2>
                    
                    <div class="form__group">
                        {{ form_label(form.current_password, null, {'label_attr': {'class': 'form__label'}}) }}
                        {{ form_widget(form.current_password) }}
                        {{ form_errors(form.current_password) }}
                    </div>

                    <div class="form__group">
                        {{ form_label(form.new_password.first, null, {'label_attr': {'class': 'form__label'}}) }}
                        {{ form_widget(form.new_password.first) }}
                        {{ form_errors(form.new_password.first) }}
                        <div class="password-strength" id="password-strength">
                            <div class="password-strength__bar">
                                <div class="password-strength__fill" id="password-strength-fill"></div>
                            </div>
                            <div class="password-strength__text" id="password-strength-text">
                                Entrez un mot de passe
                            </div>
                        </div>
                    </div>

                    <div class="form__group">
                        {{ form_label(form.new_password.second, null, {'label_attr': {'class': 'form__label'}}) }}
                        {{ form_widget(form.new_password.second) }}
                        {{ form_errors(form.new_password.second) }}
                    </div>
                </div>

                <div class="form__actions">
                    <a href="{{ path('dashboard_profile_index') }}" class="button button--secondary">
                        <i class="fas fa-arrow-left"></i>
                        Annuler
                    </a>
                    <button type="submit" class="button button--primary">
                        <i class="fas fa-key"></i>
                        Modifier le mot de passe
                    </button>
                </div>
            {{ form_end(form) }}
        </div>

        <aside class="profile-password__sidebar">
            <div class="password-requirements">
                <h3 class="password-requirements__title">
                    <i class="fas fa-shield-alt"></i>
                    Exigences du mot de passe
                </h3>
                <ul class="password-requirements__list">
                    <li class="password-requirements__item">
                        <i class="fas fa-check-circle"></i>
                        Au moins 8 caractères
                    </li>
                    <li class="password-requirements__item">
                        <i class="fas fa-check-circle"></i>
                        Une lettre majuscule
                    </li>
                    <li class="password-requirements__item">
                        <i class="fas fa-check-circle"></i>
                        Une lettre minuscule
                    </li>
                    <li class="password-requirements__item">
                        <i class="fas fa-check-circle"></i>
                        Un chiffre
                    </li>
                    <li class="password-requirements__item">
                        <i class="fas fa-check-circle"></i>
                        Un caractère spécial (@$!%*?&)
                    </li>
                </ul>
            </div>
            
            <div class="profile-tip profile-tip--warning">
                <div class="profile-tip__icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3 class="profile-tip__title">Important</h3>
                <p class="profile-tip__content">
                    Après avoir changé votre mot de passe, vous devrez vous reconnecter sur tous vos appareils. Vous recevrez également un email de confirmation.
                </p>
            </div>
        </aside>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('change_password_form_new_password_first');
            const strengthBar = document.getElementById('password-strength-fill');
            const strengthText = document.getElementById('password-strength-text');
            
            if (passwordInput && strengthBar && strengthText) {
                passwordInput.addEventListener('input', function() {
                    const password = this.value;
                    const strength = calculatePasswordStrength(password);
                    updatePasswordStrength(strength, strengthBar, strengthText);
                });
            }
            
            function calculatePasswordStrength(password) {
                let score = 0;
                const checks = [
                    password.length >= 8,
                    /[a-z]/.test(password),
                    /[A-Z]/.test(password),
                    /\d/.test(password),
                    /[@$!%*?&]/.test(password)
                ];
                
                score = checks.filter(check => check).length;
                return score;
            }
            
            function updatePasswordStrength(strength, bar, text) {
                const colors = ['#e74c3c', '#e67e22', '#f39c12', '#27ae60', '#2ecc71'];
                const texts = ['Très faible', 'Faible', 'Moyen', 'Fort', 'Très fort'];
                const widths = [20, 40, 60, 80, 100];
                
                if (strength === 0) {
                    bar.style.width = '0%';
                    text.textContent = 'Entrez un mot de passe';
                    return;
                }
                
                bar.style.width = widths[strength - 1] + '%';
                bar.style.backgroundColor = colors[strength - 1];
                text.textContent = texts[strength - 1];
            }
        });
    </script>
{% endblock %}