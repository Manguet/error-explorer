{% extends 'dashboard/base.html.twig' %}

{% block title %}Supprimer le compte - {{ parent() }}{% endblock %}

{% block page_header %}
    <div class="page-header">
        <div class="page-header__content">
            <nav class="breadcrumb">
                <a href="{{ path('dashboard_profile_index') }}" class="breadcrumb__link">Mon Profil</a>
                <span class="breadcrumb__separator">/</span>
                <span class="breadcrumb__current">Supprimer le compte</span>
            </nav>
            <h1 class="page-header__title">Supprimer le compte</h1>
            <p class="page-header__subtitle">Cette action est irréversible</p>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="profile-delete">
        <div class="profile-delete__container">
            <div class="profile-delete__warning">
                <div class="profile-delete__warning-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="profile-delete__warning-content">
                    <h2 class="profile-delete__warning-title">Attention ! Cette action est définitive</h2>
                    <p class="profile-delete__warning-text">
                        La suppression de votre compte entraînera la perte permanente de :
                    </p>
                    <ul class="profile-delete__warning-list">
                        <li>Tous vos projets et leurs données d'erreurs</li>
                        <li>Votre historique de notifications et rapports</li>
                        <li>Vos paramètres et préférences personnalisés</li>
                        <li>Votre appartenance aux équipes</li>
                        <li>Tous les fichiers et données associés à votre compte</li>
                    </ul>
                    <p class="profile-delete__warning-note">
                        <strong>Ces données ne pourront pas être récupérées.</strong>
                    </p>
                </div>
            </div>

            {{ form_start(form, {'attr': {'class': 'form form--delete-account'}}) }}
                <div class="form__section">
                    <h2 class="form__section-title">Confirmer la suppression</h2>
                    
                    <div class="form__group">
                        {{ form_label(form.password, null, {'label_attr': {'class': 'form__label'}}) }}
                        {{ form_widget(form.password) }}
                        {{ form_errors(form.password) }}
                        <p class="form__help">
                            Entrez votre mot de passe pour confirmer votre identité.
                        </p>
                    </div>

                    <div class="form__group">
                        {{ form_label(form.confirmation, null, {'label_attr': {'class': 'form__label'}}) }}
                        {{ form_widget(form.confirmation) }}
                        {{ form_errors(form.confirmation) }}
                        <p class="form__help">
                            {{ form.confirmation.vars.help }}
                        </p>
                    </div>
                </div>

                <div class="form__actions form__actions--danger">
                    <a href="{{ path('dashboard_profile_index') }}" class="button button--secondary">
                        <i class="fas fa-arrow-left"></i>
                        Annuler
                    </a>
                    <button type="submit" class="button button--danger" id="delete-account-btn" disabled>
                        <i class="fas fa-trash-alt"></i>
                        Supprimer définitivement mon compte
                    </button>
                </div>
            {{ form_end(form) }}
        </div>

        <aside class="profile-delete__sidebar">
            <div class="profile-tip profile-tip--info">
                <div class="profile-tip__icon">
                    <i class="fas fa-download"></i>
                </div>
                <h3 class="profile-tip__title">Exporter vos données</h3>
                <p class="profile-tip__content">
                    Avant de supprimer votre compte, vous pouvez exporter vos données importantes.
                </p>
                <a href="#" class="button button--outline button--small">
                    <i class="fas fa-download"></i>
                    Exporter mes données
                </a>
            </div>
            
            <div class="profile-tip profile-tip--warning">
                <div class="profile-tip__icon">
                    <i class="fas fa-pause-circle"></i>
                </div>
                <h3 class="profile-tip__title">Alternative</h3>
                <p class="profile-tip__content">
                    Si vous souhaitez simplement faire une pause, vous pouvez désactiver votre compte temporairement au lieu de le supprimer.
                </p>
                <a href="{{ path('dashboard_profile_preferences') }}" class="button button--outline button--small">
                    <i class="fas fa-cog"></i>
                    Paramètres du compte
                </a>
            </div>
        </aside>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const passwordInput = document.getElementById('delete_account_form_password');
            const confirmationInput = document.getElementById('delete_account_form_confirmation');
            const deleteButton = document.getElementById('delete-account-btn');
            
            function checkFormValidity() {
                const password = passwordInput.value.trim();
                const confirmation = confirmationInput.value.trim();
                
                if (password && confirmation === 'SUPPRIMER MON COMPTE') {
                    deleteButton.disabled = false;
                    deleteButton.classList.remove('button--disabled');
                } else {
                    deleteButton.disabled = true;
                    deleteButton.classList.add('button--disabled');
                }
            }
            
            passwordInput.addEventListener('input', checkFormValidity);
            confirmationInput.addEventListener('input', checkFormValidity);
            
            // Confirmation supplémentaire avant soumission
            deleteButton.addEventListener('click', function(e) {
                if (!confirm('Êtes-vous absolument certain de vouloir supprimer votre compte ? Cette action est irréversible.')) {
                    e.preventDefault();
                }
            });
        });
    </script>
{% endblock %}