{% extends 'emails/base_email.html.twig' %}

{% block title %}üö® Alerte Erreur - {{ project.name }} - Error Explorer{% endblock %}

{% block header_class %}email-header--error{% endblock %}

{% block status_badge %}
    <div class="status-badge">
        {% if errorGroup.httpStatusCode >= 500 %}
            üö® ALERTE CRITIQUE
        {% elseif errorGroup.occurrenceCount > 10 %}
            ‚ö†Ô∏è ALERTE √âLEV√âE
        {% else %}
            üî¥ NOUVELLE ERREUR
        {% endif %}
    </div>
{% endblock %}

{% block email_title %}Erreur d√©tect√©e{% endblock %}

{% block email_subtitle %}{{ project.name }} - {{ errorGroup.environment ?: 'Production' }}{% endblock %}

{% block body %}
    <!-- R√©sum√© de l'erreur -->
    <div class="error-card">
        <div class="card-title">
            üî¥ {{ errorGroup.exceptionClass }}
        </div>
        <div class="card-content">
            <div class="code-block">{{ errorGroup.message }}</div>
        </div>
    </div>

    <!-- M√©triques principales -->
    <div class="details-grid">
        <div class="detail-item">
            <div class="detail-label">Occurrences</div>
            <div class="detail-value">{{ errorGroup.occurrenceCount }}</div>
        </div>
        <div class="detail-item">
            <div class="detail-label">Premi√®re fois</div>
            <div class="detail-value">{{ errorGroup.firstSeen|date('d/m H:i') }}</div>
        </div>
        <div class="detail-item">
            <div class="detail-label">Derni√®re fois</div>
            <div class="detail-value">{{ errorGroup.lastSeen|date('d/m H:i') }}</div>
        </div>
        {% if errorGroup.httpStatusCode %}
            <div class="detail-item">
                <div class="detail-label">Code HTTP</div>
                <div class="detail-value">{{ errorGroup.httpStatusCode }}</div>
            </div>
        {% endif %}
    </div>

    <!-- Localisation -->
    <h3>üìç Localisation</h3>
    <div class="info-card">
        <div class="card-title">
            üìÅ {{ errorGroup.file|split('/')|last }}
        </div>
        <div class="card-content">
            <strong>Fichier :</strong> {{ errorGroup.file }}<br>
            <strong>Ligne :</strong> {{ errorGroup.line }}
        </div>
    </div>

    <!-- Stack trace si disponible -->
    {% if errorGroup.stackTracePreview %}
        <h3>üîç Aper√ßu de la Stack Trace</h3>
        <div class="code-block">{{ errorGroup.stackTracePreview|slice(0, 500) }}{% if errorGroup.stackTracePreview|length > 500 %}...{% endif %}</div>
    {% endif %}

    <!-- Actions -->
    <div class="btn-center">
        <a href="{{ dashboardUrl }}" class="btn btn-primary">
            üîç Voir les d√©tails
        </a>
        <a href="{{ dashboardUrl }}" class="btn btn-secondary">
            ‚úÖ Marquer comme r√©solu
        </a>
    </div>

    <!-- Recommandations -->
    <h3>üí° Actions recommand√©es</h3>
    <div class="info-card">
        <ul class="styled-list">
            {% if errorGroup.httpStatusCode >= 500 %}
                <li><strong>Priorit√© √©lev√©e</strong> - Erreur serveur critique affectant les utilisateurs</li>
                <li>V√©rifiez les logs serveur pour plus de contexte</li>
            {% endif %}
            {% if errorGroup.occurrenceCount > 5 %}
                <li>Cette erreur se r√©p√®te fr√©quemment ({{ errorGroup.occurrenceCount }} fois)</li>
            {% endif %}
            <li>Examinez le code autour de la ligne {{ errorGroup.line }} dans {{ errorGroup.file|split('/')|last }}</li>
            <li>Consultez la documentation pour {{ errorGroup.exceptionClass }}</li>
            <li>Marquez comme r√©solue une fois corrig√©e</li>
        </ul>
    </div>
{% endblock %}

{% block additional_footer_links %}
    <a href="{{ dashboardUrl }}?project={{ project.id }}" class="footer-link">Projet {{ project.name }}</a>
    {% if unsubscribeUrl %}
        <a href="{{ unsubscribeUrl }}" class="footer-link">Se d√©sabonner</a>
    {% endif %}
{% endblock %}
