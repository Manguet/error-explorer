{% extends 'emails/base_email.html.twig' %}

{% block title %}Alerte Performance - {{ project.name }}{% endblock %}

{% block header_class %}email-header--{% if metric.severityLevel == 'critical' %}error{% elseif metric.severityLevel == 'high' %}warning{% else %}info{% endif %}{% endblock %}

{% block status_badge %}
    <div class="status-badge">
        {% if metric.severityLevel == 'critical' %}
            üî¥ PERFORMANCE CRITIQUE
        {% elseif metric.severityLevel == 'high' %}
            üü† PERFORMANCE D√âGRAD√âE
        {% else %}
            üü° ALERTE PERFORMANCE
        {% endif %}
    </div>
{% endblock %}

{% block email_title %}Alerte Performance{% endblock %}

{% block email_subtitle %}{{ project.name }} - M√©trique critique d√©tect√©e{% endblock %}

{% block body %}
    <p>Une m√©trique de performance {{ metric.severityLevel == 'critical' ? 'critique' : (metric.severityLevel == 'high' ? '√©lev√©e' : 'importante') }} a √©t√© d√©tect√©e sur votre projet <strong>{{ project.name }}</strong>.</p>

    <!-- D√©tails de la m√©trique -->
    <h2>üìä D√©tails de la m√©trique</h2>

    <div class="{% if metric.severityLevel == 'critical' %}error-card{% elseif metric.severityLevel == 'high' %}warning-card{% else %}info-card{% endif %}">
        <div class="card-title">
            {{ metric.description }}
        </div>
        <div class="card-content">
            <div style="font-size: 32px; font-weight: 800; color: {% if metric.severityLevel == 'critical' %}#dc2626{% elseif metric.severityLevel == 'high' %}#d97706{% else %}#2563eb{% endif %}; margin: 15px 0;">
                {{ metric.valueAsFloat }} {{ metric.unit }}
            </div>
        </div>
    </div>

    <!-- Informations d√©taill√©es -->
    <div class="details-grid">
        <div class="detail-item">
            <div class="detail-label">Type de m√©trique</div>
            <div class="detail-value">{{ metric.metricType|title }}</div>
        </div>
        <div class="detail-item" style="border-left-color: {% if metric.severityLevel == 'critical' %}#ef4444{% elseif metric.severityLevel == 'high' %}#f59e0b{% else %}#3b82f6{% endif %};">
            <div class="detail-label">S√©v√©rit√©</div>
            <div class="detail-value">
                {% if metric.severityLevel == 'critical' %}
                    üî¥ Critique
                {% elseif metric.severityLevel == 'high' %}
                    üü† √âlev√©e
                {% elseif metric.severityLevel == 'medium' %}
                    üü° Moyenne
                {% else %}
                    üü¢ Normale
                {% endif %}
            </div>
        </div>
        <div class="detail-item">
            <div class="detail-label">Enregistr√©e le</div>
            <div class="detail-value">{{ metric.recordedAt|date('d/m/Y H:i:s') }}</div>
        </div>
        {% if metric.environment %}
            <div class="detail-item">
                <div class="detail-label">Environnement</div>
                <div class="detail-value">{{ metric.environment }}</div>
            </div>
        {% endif %}
    </div>

    <!-- Source si disponible -->
    {% if metric.source %}
        <div class="info-card">
            <div class="card-title">
                üìç Source
            </div>
            <div class="card-content">
                {{ metric.source }}
            </div>
        </div>
    {% endif %}

    <!-- M√©tadonn√©es suppl√©mentaires -->
    {% if metric.metadata and metric.metadata|length > 0 %}
        <h3>üîç Informations suppl√©mentaires</h3>
        <div class="info-card">
            <div class="card-content">
                {% for key, value in metric.metadata %}
                    <div style="display: flex; justify-content: space-between; padding: 8px 0; {% if not loop.last %}border-bottom: 1px solid #e2e8f0;{% endif %}">
                        <strong>{{ key|title }}:</strong>
                        <span>{{ value }}</span>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}

    <!-- Recommandations sp√©cifiques -->
    <h3>üí° Recommandations</h3>
    <div class="{% if metric.severityLevel == 'critical' %}error-card{% else %}warning-card{% endif %}">
        <div class="card-content">
            {% if metric.metricType == 'response_time' %}
                <ul class="styled-list">
                    <li>V√©rifiez la charge du serveur et les ressources disponibles</li>
                    <li>Analysez les requ√™tes de base de donn√©es lentes</li>
                    <li>Consid√©rez l'activation du cache ou l'optimisation du code</li>
                    <li>Surveillez l'utilisation du CPU et de la m√©moire</li>
                </ul>
            {% elseif metric.metricType == 'error_rate' %}
                <ul class="styled-list">
                    <li>Consultez imm√©diatement le dashboard des erreurs</li>
                    <li>V√©rifiez les logs applicatifs r√©cents</li>
                    <li>Surveillez l'impact sur les utilisateurs</li>
                    <li>Analysez les patterns d'erreurs r√©currentes</li>
                </ul>
            {% elseif metric.metricType == 'cpu_usage' %}
                <ul class="styled-list">
                    <li>V√©rifiez les processus consommant le plus de CPU</li>
                    <li>Consid√©rez l'augmentation des ressources serveur</li>
                    <li>Optimisez le code gourmand en calcul</li>
                    <li>Analysez les pics d'utilisation</li>
                </ul>
            {% elseif metric.metricType == 'memory_usage' %}
                <ul class="styled-list">
                    <li>Recherchez les fuites m√©moire potentielles</li>
                    <li>V√©rifiez la configuration des limites PHP/applicatives</li>
                    <li>Optimisez l'utilisation des variables et objets</li>
                    <li>Surveillez la garbage collection</li>
                </ul>
            {% else %}
                <ul class="styled-list">
                    <li>Consultez votre dashboard de monitoring pour plus de d√©tails</li>
                    <li>V√©rifiez les logs applicatifs et serveur</li>
                    <li>Surveillez l'√©volution de cette m√©trique</li>
                    <li>Comparez avec les m√©triques historiques</li>
                </ul>
            {% endif %}
        </div>
    </div>

    <!-- Actions urgentes si critique -->
    {% if metric.severityLevel == 'critical' %}
        <div class="error-card">
            <div class="card-title">
                üö® Actions urgentes recommand√©es
            </div>
            <div class="card-content">
                Cette m√©trique critique n√©cessite une attention imm√©diate.
                Les performances d√©grad√©es peuvent impacter s√©rieusement l'exp√©rience utilisateur.
            </div>
        </div>
    {% endif %}

    <!-- Bouton d'action -->
    <div class="btn-center">
        <a href="{{ dashboardUrl }}" class="btn {% if metric.severityLevel == 'critical' %}btn-danger{% else %}btn-primary{% endif %}" style="{% if metric.severityLevel == 'critical' %}font-size: 18px; padding: 16px 32px;{% endif %}">
            üìä Voir le Dashboard
        </a>
    </div>

    <!-- Conseils de monitoring -->
    <div class="info-card">
        <div class="card-title">
            üìà Conseils de monitoring
        </div>
        <div class="card-content">
            <ul class="styled-list">
                <li>Surveillez r√©guli√®rement vos m√©triques de performance</li>
                <li>Configurez des seuils d'alerte adapt√©s √† votre application</li>
                <li>Analysez les tendances sur plusieurs p√©riodes</li>
                <li>Mettez en place des actions automatiques si possible</li>
            </ul>
        </div>
    </div>
{% endblock %}

{% block additional_footer_links %}
    <a href="{{ dashboardUrl }}/metrics" class="footer-link">M√©triques d√©taill√©es</a>
    {% if unsubscribeUrl %}
        <a href="{{ unsubscribeUrl }}" class="footer-link">Se d√©sabonner</a>
    {% endif %}
{% endblock %}

{% block footer_legal %}
    Alerte performance g√©n√©r√©e par Error Explorer<br>
    {{ "now"|date('d/m/Y √† H:i') }} | Projet: {{ project.name }}
{% endblock %}
