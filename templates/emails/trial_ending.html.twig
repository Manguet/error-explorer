{% extends 'emails/base_email.html.twig' %}

{% block title %}Fin d'essai proche - Error Explorer{% endblock %}

{% block header_class %}email-header--warning{% endblock %}

{% block status_badge %}
    <div class="status-badge">
        ‚è∞ ESSAI SE TERMINE
    </div>
{% endblock %}

{% block email_title %}Votre essai se termine bient√¥t{% endblock %}

{% block email_subtitle %}Il vous reste {{ subscription.trialDaysRemaining }} jour{{ subscription.trialDaysRemaining > 1 ? 's' : '' }} pour profiter de toutes les fonctionnalit√©s{% endblock %}

{% block body %}
    <h2>Bonjour {{ user.firstName }},</h2>

    <p>Votre p√©riode d'essai gratuit Error Explorer touche √† sa fin. Nous esp√©rons que vous avez pu d√©couvrir la puissance de notre plateforme de monitoring !</p>

    <!-- Temps restant -->
    <div class="warning-card">
        <div class="card-title">
            ‚è∞ Temps restant
        </div>
        <div class="card-content text-center">
            <div style="font-size: 48px; font-weight: 800; color: #d97706; margin: 15px 0;">
                {{ subscription.trialDaysRemaining }}
            </div>
            <div style="font-size: 18px; margin-bottom: 10px;">
                {{ subscription.trialDaysRemaining == 1 ? 'jour restant' : 'jours restants' }}
            </div>
            <div style="color: #92400e;">
                Votre essai se termine le <strong>{{ subscription.trialEnd | date('d/m/Y') }}</strong>
            </div>
        </div>
    </div>

    <!-- Utilisation pendant l'essai -->
    {% if user.currentMonthlyErrors > 0 or user.currentProjectsCount > 0 %}
        <h3>üìä Votre utilisation pendant l'essai</h3>
        <div class="details-grid">
            <div class="detail-item">
                <div class="detail-label">Projets cr√©√©s</div>
                <div class="detail-value">{{ user.currentProjectsCount }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Erreurs re√ßues</div>
                <div class="detail-value">{{ user.currentMonthlyErrors }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">R√©tention</div>
                <div class="detail-value">{{ subscription.plan.dataRetentionDays }} jours</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Satisfaction</div>
                <div class="detail-value">üíØ %</div>
            </div>
        </div>
    {% endif %}

    <!-- Fonctionnalit√©s √† continuer -->
    <h3>‚ö° Continuez √† b√©n√©ficier de toutes ces fonctionnalit√©s</h3>
    <div class="success-card">
        <div class="card-content">
            <ul class="styled-list">
                <li>{{ subscription.plan.maxProjects == -1 ? 'Projets illimit√©s' : subscription.plan.maxProjects ~ ' projets maximum' }}</li>
                <li>{{ subscription.plan.maxMonthlyErrors == -1 ? 'Erreurs illimit√©es' : (subscription.plan.maxMonthlyErrors ~ ' erreurs par mois') }}</li>
                <li>R√©tention des donn√©es : {{ subscription.plan.dataRetentionDays }} jours</li>
                {% if subscription.plan.emailAlerts %}
                    <li>Alertes par email personnalis√©es</li>
                {% endif %}
                {% if subscription.plan.slackIntegration %}
                    <li>Int√©grations Slack et Discord</li>
                {% endif %}
                {% if subscription.plan.apiAccess %}
                    <li>Acc√®s API complet</li>
                {% endif %}
                <li>Support technique prioritaire</li>
                <li>Analytics et graphiques avanc√©s</li>
            </ul>
        </div>
    </div>

    <!-- Prix attractif -->
    <div class="info-card text-center">
        <div class="card-title">
            üí∞ Continuez sans interruption
        </div>
        <div class="card-content">
            <div style="font-size: 24px; font-weight: 700; margin: 15px 0;">
                Seulement {{ subscription.formattedAmount }}/{{ subscription.isYearly ? 'an' : 'mois' }}
            </div>
            <div>
                {% if subscription.isYearly %}
                    üéâ √âconomisez 2 mois avec l'abonnement annuel !
                {% else %}
                    üí° √âconomisez 20% avec l'abonnement annuel
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Bouton principal -->
    <div class="btn-center">
        <a href="{{ app_url }}{{ path('billing_dashboard') }}" class="btn btn-primary" style="font-size: 18px; padding: 16px 32px;">
            üöÄ Activer mon abonnement
        </a>
    </div>

    <!-- Aucune action requise -->
    <div class="success-card">
        <div class="card-title">
            üí≥ Aucune action requise
        </div>
        <div class="card-content">
            Si vous avez d√©j√† enregistr√© une m√©thode de paiement, votre abonnement sera automatiquement activ√© √† la fin de l'essai.
            Vous pouvez annuler √† tout moment.
        </div>
    </div>

    <!-- Que se passe-t-il sinon -->
    <h3>‚ùì Que se passe-t-il si je n'active pas mon abonnement ?</h3>
    <div class="info-card">
        <div class="card-content">
            <ul class="styled-list">
                <li>Votre compte passera automatiquement au plan gratuit</li>
                <li>Vos projets et donn√©es seront conserv√©s selon les limites gratuites</li>
                <li>Vous pourrez r√©activer votre abonnement √† tout moment</li>
                <li>Aucun frais ne sera pr√©lev√© sans votre accord</li>
            </ul>
        </div>
    </div>

    <!-- Boutons secondaires -->
    <div class="btn-center">
        <a href="{{ app_url }}{{ path('home_pricing') }}" class="btn btn-secondary">
            üìã Voir tous les plans
        </a>
        <a href="{{ app_url }}{{ path('home_contact') }}" class="btn btn-secondary">
            üí¨ Contacter l'√©quipe
        </a>
    </div>

    <p class="text-center">
        Merci de nous faire confiance pour prot√©ger vos applications !<br>
        <strong>L'√©quipe Error Explorer</strong>
    </p>
{% endblock %}

{% block additional_footer_links %}
    <a href="{{ app_url }}{{ path('billing_dashboard') }}" class="footer-link">G√©rer mon abonnement</a>
    <a href="{{ app_url }}{{ path('home_pricing') }}" class="footer-link">Plans et tarifs</a>
{% endblock %}

{% block footer_legal %}
    Rappel de fin d'essai pour Error Explorer<br>
    {{ "now"|date('d/m/Y √† H:i') }} | Essai se termine le {{ subscription.trialEnd | date('d/m/Y') }}
{% endblock %}
