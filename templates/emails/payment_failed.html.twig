{% extends 'emails/base_email.html.twig' %}

{% block title %}√âchec du paiement - Error Explorer{% endblock %}

{% block header_class %}email-header--error{% endblock %}

{% block status_badge %}
    <div class="status-badge">
        ‚ö†Ô∏è PAIEMENT √âCHOU√â
    </div>
{% endblock %}

{% block email_title %}√âchec du paiement{% endblock %}

{% block email_subtitle %}Action requise pour maintenir votre abonnement{% endblock %}

{% block body %}
    <h2>Bonjour {{ user.firstName }},</h2>

    <p>Nous n'avons pas pu traiter votre paiement pour votre abonnement Error Explorer. Ne vous inqui√©tez pas, c'est un probl√®me courant et facilement r√©solvable.</p>

    {% if invoice %}
        <!-- D√©tails de la facture -->
        <h3>üí≥ D√©tails de la facture</h3>
        <div class="details-grid">
            <div class="detail-item">
                <div class="detail-label">Facture</div>
                <div class="detail-value">#{{ invoice.number }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Montant</div>
                <div class="detail-value">{{ invoice.formattedTotal }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Plan</div>
                <div class="detail-value">{{ invoice.subscription.plan.name }}</div>
            </div>
            {% if invoice.dueDate %}
                <div class="detail-item">
                    <div class="detail-label">√âch√©ance</div>
                    <div class="detail-value">{{ invoice.dueDate | date('d/m/Y') }}</div>
                </div>
            {% endif %}
        </div>
    {% endif %}

    <!-- Que se passe-t-il maintenant -->
    <div class="warning-card">
        <div class="card-title">
            üìÖ Que se passe-t-il maintenant ?
        </div>
        <div class="card-content">
            <ul class="styled-list">
                <li>Votre abonnement reste actif pendant quelques jours</li>
                <li>Nous r√©essaierons automatiquement le paiement</li>
                <li>Vous pouvez mettre √† jour votre m√©thode de paiement √† tout moment</li>
                <li>Aucune interruption de service pour l'instant</li>
            </ul>
        </div>
    </div>

    <!-- Bouton d'action principal -->
    <div class="btn-center">
        <a href="{{ app.request.schemeAndHttpHost }}{{ path('billing_dashboard') }}" class="btn btn-primary" style="font-size: 18px; padding: 16px 32px;">
            üí≥ Mettre √† jour ma m√©thode de paiement
        </a>
    </div>

    <!-- Causes possibles -->
    <h3>üîç Causes possibles de l'√©chec</h3>
    <div class="info-card">
        <div class="card-content">
            <ul class="styled-list">
                <li><strong>Fonds insuffisants</strong> - V√©rifiez le solde de votre compte</li>
                <li><strong>Carte expir√©e</strong> - Mettez √† jour vos informations de paiement</li>
                <li><strong>Limite d√©pass√©e</strong> - Contactez votre banque pour autoriser le paiement</li>
                <li><strong>Donn√©es incorrectes</strong> - V√©rifiez les informations de votre carte</li>
            </ul>
        </div>
    </div>

    <!-- Actions recommand√©es -->
    <h3>‚úÖ Actions recommand√©es</h3>
    <div class="success-card">
        <div class="card-title">
            üõ†Ô∏è √âtapes √† suivre
        </div>
        <div class="card-content">
            <ol style="padding-left: 20px; margin: 0;">
                <li>V√©rifiez les informations de votre carte bancaire</li>
                <li>Assurez-vous que votre carte n'est pas expir√©e</li>
                <li>Contactez votre banque si n√©cessaire</li>
                <li>Ajoutez une nouvelle m√©thode de paiement si besoin</li>
            </ol>
        </div>
    </div>

    <!-- Service reste actif -->
    {% if subscription and subscription.isActive %}
        <div class="success-card">
            <div class="card-title">
                ‚ÑπÔ∏è Votre service reste actif
            </div>
            <div class="card-content">
                Votre abonnement Error Explorer continue de fonctionner normalement.
                Vous avez quelques jours pour r√©soudre ce probl√®me de paiement sans interruption de service.
            </div>
        </div>
    {% endif %}

    <!-- Boutons secondaires -->
    <div class="btn-center">
        <a href="{{ app.request.schemeAndHttpHost }}{{ path('home_contact') }}" class="btn btn-secondary">
            üí¨ Contacter le support
        </a>
        <a href="{{ app.request.schemeAndHttpHost }}{{ path('billing_dashboard') }}" class="btn btn-secondary">
            üìä Voir ma facturation
        </a>
    </div>

    <!-- Que se passe-t-il si pas de r√©solution -->
    <div class="info-card">
        <div class="card-title">
            ‚ùì Que se passe-t-il si je n'active pas mon abonnement ?
        </div>
        <div class="card-content">
            <ul style="margin: 0; padding-left: 20px;">
                <li>Votre compte passera automatiquement au plan gratuit</li>
                <li>Vos projets et donn√©es seront conserv√©s selon les limites gratuites</li>
                <li>Vous pourrez r√©activer votre abonnement √† tout moment</li>
                <li>Aucun frais suppl√©mentaire ne sera pr√©lev√©</li>
            </ul>
        </div>
    </div>

    <p class="text-center">
        Nous sommes l√† pour vous aider √† r√©soudre ce probl√®me rapidement.<br>
        <strong>L'√©quipe Error Explorer</strong>
    </p>
{% endblock %}

{% block additional_footer_links %}
    <a href="{{ app.request.schemeAndHttpHost }}{{ path('billing_dashboard') }}" class="footer-link">G√©rer mon abonnement</a>
    <a href="{{ app.request.schemeAndHttpHost }}{{ path('home_contact') }}" class="footer-link">Support</a>
{% endblock %}

{% block footer_legal %}
    Notification d'√©chec de paiement pour Error Explorer<br>
    {{ "now"|date('d/m/Y √† H:i') }} | Si vous pensez qu'il s'agit d'une erreur, contactez-nous
{% endblock %}
