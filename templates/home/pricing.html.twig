{% extends('layout/base.html.twig') %}

{% block title %}Tarifs - Error Explorer{% endblock %}
{% block description %}Découvrez nos plans de monitoring d'erreurs : gratuit, professionnel ou entreprise. Tarifs transparents, sans engagement, avec toutes les fonctionnalités essentielles.{% endblock %}

{% block body %}
    <section class="pricing-hero">
        <div class="pricing-hero-content">
            <div class="hero-badge">
                <div class="badge-dot"></div>
                <span>Tarifs transparents</span>
            </div>

            <h1>
                Choisissez le plan qui
                <span class="highlight">correspond à vos besoins</span>
            </h1>

            <p>
                Commencez gratuitement et évoluez à votre rythme.
                Pas de frais cachés, pas d'engagement, annulation possible à tout moment.
            </p>

            <div class="billing-toggle" id="billing-toggle">
                <div class="billing-option active" data-period="monthly">
                    Mensuel
                </div>
                <div class="billing-option" data-period="yearly">
                    Annuel
                </div>
            </div>
        </div>
    </section>

    <section class="pricing-section">
        <div class="container">
            <div class="pricing-grid">
                {% for plan in plans %}
                    <div class="pricing-card {{ plan.isPopular ? 'popular' : '' }}">
                        {% if plan.isPopular %}
                            <div class="popular-badge">Plus populaire</div>
                        {% endif %}

                        <div class="plan-header">
                            <h3 class="plan-name">{{ plan.name }}</h3>

                            <div class="monthly-price">
                                <div class="plan-price">
                                    {% if plan.isFree %}
                                        Gratuit
                                    {% else %}
                                        {{ plan.priceMonthly|number_format(2, ',', ' ') }}€
                                    {% endif %}
                                </div>
                                {% if not plan.isFree %}
                                    <div class="plan-price-period">par mois</div>
                                {% else %}
                                    <div class="plan-price-period">à vie</div>
                                {% endif %}
                            </div>

                            {% if not plan.isFree and plan.priceYearly %}
                                <div class="yearly-price" style="display: none;">
                                    <div class="plan-price">
                                        {{ plan.priceYearly|number_format(2, ',', ' ') }}€
                                    </div>
                                    <div class="plan-price-period">par an</div>
                                </div>
                            {% elseif plan.isFree %}
                                <div class="yearly-price" style="display: none;">
                                    <div class="plan-price">
                                        Gratuit
                                    </div>
                                    <div class="plan-price-period">à vie</div>
                                </div>
                            {% endif %}
                        </div>

                        <p class="plan-description">{{ plan.description }}</p>

                        <div class="plan-features">
                            <div class="features-title">Ce qui est inclus :</div>
                            <ul class="features-list">
                                <li class="feature-item">
                                    <span class="feature-check">{{ plan.maxProjectsLabel }}</span>
                                    <span>Projets {{ plan.maxProjects == -1 ? 'illimités' : 'maximum' }}</span>
                                </li>
                                <li class="feature-item">
                                    <span class="feature-check">{{ plan.maxMonthlyErrorsLabel }}</span>
                                    <span>Erreurs par mois</span>
                                </li>
                                <li class="feature-item">
                                    <span class="feature-check">{{ plan.dataRetentionDays }}</span>
                                    <span>Jours de rétention des données</span>
                                </li>
                                <li class="feature-item">
                                    <span class="feature-check">✓</span>
                                    <span>Dashboard temps réel</span>
                                </li>
                                <li class="feature-item">
                                    <span class="feature-check">✓</span>
                                    <span>Stack trace détaillé</span>
                                </li>
                                {% if plan.hasEmailAlerts %}
                                    <li class="feature-item">
                                        <span class="feature-check">✓</span>
                                        <span>Alertes email</span>
                                    </li>
                                {% else %}
                                    <li class="feature-item disabled">
                                        <span class="feature-check">✗</span>
                                        <span>Alertes email</span>
                                    </li>
                                {% endif %}
                                {% if plan.hasSlackIntegration %}
                                    <li class="feature-item">
                                        <span class="feature-check">✓</span>
                                        <span>Intégration Slack</span>
                                    </li>
                                {% else %}
                                    <li class="feature-item disabled">
                                        <span class="feature-check">✗</span>
                                        <span>Intégration Slack</span>
                                    </li>
                                {% endif %}
                                {% if plan.hasApiAccess %}
                                    <li class="feature-item">
                                        <span class="feature-check">✓</span>
                                        <span>Accès API complet</span>
                                    </li>
                                {% else %}
                                    <li class="feature-item disabled">
                                        <span class="feature-check">✗</span>
                                        <span>Accès API complet</span>
                                    </li>
                                {% endif %}
                                {% if plan.hasAdvancedFilters %}
                                    <li class="feature-item">
                                        <span class="feature-check">✓</span>
                                        <span>Filtres avancés</span>
                                    </li>
                                {% else %}
                                    <li class="feature-item disabled">
                                        <span class="feature-check">✗</span>
                                        <span>Filtres avancés</span>
                                    </li>
                                {% endif %}
                                {% if plan.hasPrioritySupport %}
                                    <li class="feature-item">
                                        <span class="feature-check">✓</span>
                                        <span>Support prioritaire (1h)</span>
                                    </li>
                                {% elseif plan.hasEmailAlerts %}
                                    <li class="feature-item">
                                        <span class="feature-check">✓</span>
                                        <span>Support standard (4h)</span>
                                    </li>
                                {% else %}
                                    <li class="feature-item">
                                        <span class="feature-check">✓</span>
                                        <span>Support communautaire (24h)</span>
                                    </li>
                                {% endif %}
                            </ul>
                        </div>

                        <div class="plan-cta">
                            {% if app.user %}
                                {# Utilisateur connecté #}
                                {% if plan.priceMonthly == 0 %}
                                    <a href="{{ path('dashboard_index') }}"
                                       class="cta-btn cta-btn-secondary">
                                        Accéder au dashboard
                                    </a>
                                {% else %}
                                    <a href="{{ path('billing_checkout', {planId: plan.id}) }}"
                                       class="cta-btn {{ plan.isPopular ? 'cta-btn-primary' : 'cta-btn-secondary' }}">
                                        Choisir {{ plan.name }}
                                    </a>
                                {% endif %}
                            {% else %}
                                {# Utilisateur non connecté #}
                                {% if plan.priceMonthly == 0 %}
                                    <a href="{{ path('app_register') }}?plan={{ plan.slug }}"
                                       class="cta-btn cta-btn-secondary">
                                        Commencer gratuitement
                                    </a>
                                {% else %}
                                    <a href="{{ path('app_register') }}?plan={{ plan.slug }}"
                                       class="cta-btn {{ plan.isPopular ? 'cta-btn-primary' : 'cta-btn-secondary' }}">
                                        Commencer avec {{ plan.name }}
                                    </a>
                                {% endif %}
                            {% endif %}

                            {% if plan.priceMonthly != 0 %}
                                <div class="plan-note">
                                    {% if plan.trialDays %}
                                        Essai gratuit {{ plan.trialDays }} jours • Sans engagement
                                    {% else %}
                                        Sans engagement • Annulation à tout moment
                                    {% endif %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <section class="pricing" id="comparison">
        <div class="container">
            <div class="section-title">
                <h2>Comparaison détaillée des plans</h2>
                <p>Comparez toutes les fonctionnalités de nos différents plans</p>
            </div>

            <div class="pricing-comparison">
                <table class="comparison-table">
                    <thead>
                    <tr>
                        <th class="feature-column">Fonctionnalités</th>
                        {% for plan in plans %}
                            <th class="plan-column {{ plan.isPopular ? 'popular' : '' }}">
                                <div class="plan-info">
                                    <h3 class="plan-name">{{ plan.name }}</h3>
                                    {% if plan.isPopular %}
                                        <div class="popular-badge">
                                            <span class="badge-icon">⭐</span>
                                            <span>Plus populaire</span>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="plan-price-container">
                                    <div class="plan-price">
                                        {% if plan.isFree %}
                                            Gratuit
                                        {% else %}
                                            {{ plan.priceMonthly|number_format(2, ',', ' ') }}€
                                        {% endif %}
                                    </div>
                                    {% if not plan.isFree %}
                                        <div class="plan-price-unit">par mois</div>
                                    {% else %}
                                        <div class="plan-price-unit">à vie</div>
                                    {% endif %}
                                </div>
                                <div class="plan-action">
                                    <a href="{{ path('app_register') }}?plan={{ plan.slug }}"
                                       class="btn {{ plan.isPopular ? 'btn-primary' : 'btn-secondary' }}">
                                        {% if plan.isFree %}
                                            <span>Commencer</span>
                                        {% else %}
                                            <span>Choisir</span>
                                        {% endif %}
                                    </a>
                                </div>
                            </th>
                        {% endfor %}
                    </tr>
                    </thead>
                    <tbody>
                    <!-- Limites et quotas -->
                    <tr class="category-row">
                        <td colspan="{{ plans|length + 1 }}" class="category-header">
                            <h4>Limites et quotas</h4>
                        </td>
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Projets maximum</div>
                            <div class="feature-description">Nombre de projets que vous pouvez monitorer</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                <div class="metric-value">{{ plan.maxProjectsLabel }}</div>
                            </td>
                        {% endfor %}
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Erreurs par mois</div>
                            <div class="feature-description">Nombre d'erreurs trackées mensuellement</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                <div class="metric-value">{{ plan.maxMonthlyErrorsLabel }}</div>
                            </td>
                        {% endfor %}
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Rétention des données</div>
                            <div class="feature-description">Durée de conservation des erreurs</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                <div class="metric-value">{{ plan.dataRetentionDays }} jours</div>
                            </td>
                        {% endfor %}
                    </tr>

                    <!-- Fonctionnalités de base -->
                    <tr class="category-row">
                        <td colspan="{{ plans|length + 1 }}" class="category-header">
                            <h4>Fonctionnalités de base</h4>
                        </td>
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Dashboard temps réel</div>
                            <div class="feature-description">Interface de monitoring en temps réel</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                <span class="feature-check">✓</span>
                            </td>
                        {% endfor %}
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Alertes email</div>
                            <div class="feature-description">Notifications par email des erreurs critiques</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                {% if plan.hasEmailAlerts %}
                                    <span class="feature-check">✓</span>
                                {% else %}
                                    <span class="feature-cross">✗</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>

                    <!-- Intégrations -->
                    <tr class="category-row">
                        <td colspan="{{ plans|length + 1 }}" class="category-header">
                            <h4>Intégrations</h4>
                        </td>
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Intégration Slack</div>
                            <div class="feature-description">Notifications directement dans Slack</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                {% if plan.hasSlackIntegration %}
                                    <span class="feature-check">✓</span>
                                {% else %}
                                    <span class="feature-cross">✗</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Accès API complet</div>
                            <div class="feature-description">API REST pour intégrations personnalisées</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                {% if plan.hasApiAccess %}
                                    <span class="feature-check">✓</span>
                                {% else %}
                                    <span class="feature-cross">✗</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>

                    <!-- Fonctionnalités avancées -->
                    <tr class="category-row">
                        <td colspan="{{ plans|length + 1 }}" class="category-header">
                            <h4>Fonctionnalités avancées</h4>
                        </td>
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Filtres avancés</div>
                            <div class="feature-description">Filtrage et recherche avancée des erreurs</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                {% if plan.hasAdvancedFilters %}
                                    <span class="feature-check">✓</span>
                                {% else %}
                                    <span class="feature-cross">✗</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Analytics avancées</div>
                            <div class="feature-description">Rapports détaillés et métriques avancées</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                {% if plan.hasAdvancedAnalytics %}
                                    <span class="feature-check">✓</span>
                                {% else %}
                                    <span class="feature-cross">✗</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Rétention personnalisée</div>
                            <div class="feature-description">Configuration personnalisée de la rétention</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                {% if plan.hasCustomRetention %}
                                    <span class="feature-check">✓</span>
                                {% else %}
                                    <span class="feature-cross">✗</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>

                    <!-- Intelligence Artificielle -->
                    {% set hasAiFeatures = false %}
                    {% for plan in plans %}
                        {% if plan.hasAiSuggestions %}
                            {% set hasAiFeatures = true %}
                        {% endif %}
                    {% endfor %}

                    {% if hasAiFeatures %}
                        <tr class="category-row">
                            <td colspan="{{ plans|length + 1 }}" class="category-header">
                                <h4>Intelligence Artificielle</h4>
                            </td>
                        </tr>

                        <tr class="feature-row">
                            <td class="feature-name">
                                <div class="feature-title">Suggestions IA</div>
                                <div class="feature-description">Suggestions automatiques pour résoudre les erreurs</div>
                            </td>
                            {% for plan in plans %}
                                <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                    {% if plan.hasAiSuggestions %}
                                        <span class="feature-check">✓</span>
                                    {% else %}
                                        <span class="feature-cross">✗</span>
                                    {% endif %}
                                </td>
                            {% endfor %}
                        </tr>

                        <tr class="feature-row">
                            <td class="feature-name">
                                <div class="feature-title">Suggestions IA par mois</div>
                                <div class="feature-description">Nombre de suggestions IA disponibles</div>
                            </td>
                            {% for plan in plans %}
                                <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                    {% if plan.hasAiSuggestions %}
                                        <div class="metric-value">{{ plan.maxMonthlyAiSuggestionsLabel }}</div>
                                    {% else %}
                                        <span class="feature-cross">✗</span>
                                    {% endif %}
                                </td>
                            {% endfor %}
                        </tr>
                    {% endif %}

                    <!-- Support -->
                    <tr class="category-row">
                        <td colspan="{{ plans|length + 1 }}" class="category-header">
                            <h4>Support</h4>
                        </td>
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Temps de réponse</div>
                            <div class="feature-description">Délai moyen de réponse du support</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                <div class="metric-value">
                                    {% if plan.hasPrioritySupport %}
                                        1h
                                    {% elseif plan.hasEmailAlerts %}
                                        4h
                                    {% else %}
                                        24h
                                    {% endif %}
                                </div>
                            </td>
                        {% endfor %}
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Support prioritaire</div>
                            <div class="feature-description">Accès au support premium avec priorité</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                {% if plan.hasPrioritySupport %}
                                    <span class="feature-check">✓</span>
                                {% else %}
                                    <span class="feature-cross">✗</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>

                    <!-- Tarification annuelle -->
                    <tr class="category-row">
                        <td colspan="{{ plans|length + 1 }}" class="category-header">
                            <h4>Tarification annuelle</h4>
                        </td>
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Prix annuel</div>
                            <div class="feature-description">Tarif avec engagement annuel</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                {% if plan.isFree %}
                                    <div class="metric-value">Gratuit</div>
                                {% elseif plan.priceYearly %}
                                    <div class="metric-value">{{ plan.formattedPriceYearly }}</div>
                                {% else %}
                                    <span class="feature-cross">N/A</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>

                    <tr class="feature-row">
                        <td class="feature-name">
                            <div class="feature-title">Économies annuelles</div>
                            <div class="feature-description">Montant économisé avec l'abonnement annuel</div>
                        </td>
                        {% for plan in plans %}
                            <td class="feature-value {{ plan.isPopular ? 'popular' : '' }}">
                                {% if plan.priceYearly and plan.priceYearly > 0 %}
                                    <div class="yearly-savings">
                                        <div class="savings-badge">
                                            <span class="metric-value">{{ ((plan.priceMonthly * 12) - (plan.priceYearly))|number_format(2, ',', ' ') }} €</span>
                                        </div>
                                    </div>
                                {% else %}
                                    <span class="feature-cross">N/A</span>
                                {% endif %}
                            </td>
                        {% endfor %}
                    </tr>
                    </tbody>
                </table>
            </div>

            <!-- Actions finales -->
            <div class="pricing-grid">
                {% for plan in plans %}
                    <div class="pricing-card {{ plan.isPopular ? 'popular' : '' }}">
                        <div class="plan-header">
                            <div class="plan-info">
                                <h3 class="plan-name">{{ plan.name }}</h3>
                            </div>
                            <div class="plan-price-container">
                                <div class="plan-price">
                                    {% if plan.isFree %}
                                        Gratuit
                                    {% else %}
                                        {{ plan.priceMonthly|number_format(2, ',', ' ') }}€
                                    {% endif %}
                                </div>
                                {% if not plan.isFree %}
                                    <div class="plan-price-unit">par mois</div>
                                {% else %}
                                    <div class="plan-price-unit">à vie</div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="plan-action">
                            <a href="{{ path('app_register') }}?plan={{ plan.slug }}"
                               class="btn {{ plan.isPopular ? 'btn-primary' : 'btn-secondary' }} plan-cta-btn"
                               data-plan="{{ plan.slug }}">
                                {% if plan.isFree %}
                                    <span>Commencer gratuitement</span>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M5 12h14M12 5l7 7-7 7"/>
                                    </svg>
                                {% else %}
                                    <span>Choisir {{ plan.name }}</span>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M5 12h14M12 5l7 7-7 7"/>
                                    </svg>
                                {% endif %}
                            </a>

                            {% if not plan.isFree %}
                                <div class="plan-note">
                                    Sans engagement • Annulation à tout moment
                                </div>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <section class="faq-section">
        <div class="container">
            <div class="section-title">
                <h2>Questions fréquentes</h2>
                <p>Tout ce que vous devez savoir sur nos tarifs</p>
            </div>

            <div class="faq-grid">
                <div class="faq-item">
                    <h3 class="faq-question">Puis-je changer de plan à tout moment ?</h3>
                    <p class="faq-answer">
                        Oui, vous pouvez passer à un plan supérieur ou inférieur à tout moment.
                        Les changements prennent effet immédiatement et nous ajustons votre facturation au prorata.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">Que se passe-t-il si je dépasse mes limites ?</h3>
                    <p class="faq-answer">
                        Nous vous prévenons par email lorsque vous atteignez 80% de vos limites.
                        Au-delà, les nouvelles erreurs ne seront plus traitées jusqu'au mois suivant ou jusqu'à votre upgrade.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">Y a-t-il des frais de configuration ?</h3>
                    <p class="faq-answer">
                        Aucun frais caché ! Le prix affiché est tout compris.
                        L'installation se fait en moins de 5 minutes avec notre documentation complète.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">Proposez-vous des remises pour les non-profits ?</h3>
                    <p class="faq-answer">
                        Oui, nous offrons 50% de réduction sur tous nos plans payants pour les organisations à but non lucratif.
                        Contactez-nous avec vos justificatifs.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">Puis-je annuler à tout moment ?</h3>
                    <p class="faq-answer">
                        Absolument. Pas d'engagement, pas de frais d'annulation.
                        Vous gardez accès à vos données pendant 30 jours après l'annulation.
                    </p>
                </div>

                <div class="faq-item">
                    <h3 class="faq-question">Mes données sont-elles sécurisées ?</h3>
                    <p class="faq-answer">
                        Toutes vos données sont chiffrées en transit et au repos.
                        Nous sommes conformes RGPD et effectuons des audits de sécurité réguliers.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <section class="cta-section">
        <div class="container">
            <div class="cta-content">
                <h2>Prêt à commencer ?</h2>
                <p>
                    Rejoignez des milliers de développeurs qui font confiance à Error Explorer
                    pour maintenir leurs applications en parfaite santé.
                </p>

                <div class="cta-actions">
                    <a href="{{ path('app_register') }}" class="btn btn-primary">
                        <span>Commencer gratuitement</span>
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </a>
                    <a href="{{ path('contact') }}" class="btn btn-secondary">
                        <span>Nous contacter</span>
                    </a>
                </div>
            </div>
        </div>
    </section>
{% endblock %}
